#!/bin/bash
set -x

if [ ! -z "${GITLAB_REF_TO_TRIGGER}" ]
then
  REF="${GITLAB_REF_TO_TRIGGER}"
else
  REF=master
fi

cat > /tmp/payload.json <<EOF
{
  "ref":"${REF}",
  "variables": $(cat $GITHUB_EVENT_PATH)
}
EOF

cat /tmp/payload.json

if [ ! -z "${SOCKS5_PROXY}" ]
then
  CURL_PROXY_ARGS="-x ${SOCKS5_PROXY}"
fi

curl -s -X POST \
    ${CURL_PROXY_ARGS} \
    -H "Content-Type: application/json" \
    -d@/tmp/payload.json \
    ${GITLAB_WEBHOOK_URL}
